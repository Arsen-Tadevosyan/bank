<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="Chitrakoot Web">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="Banking and Loan Responsive Template">
    <meta name="description" content="Loan- Banking and Loan Responsive Template">

    <!-- title  -->
    <title>Credit List</title>

    <!-- favicon -->
    <link rel="shortcut icon" href="/img/logos/favicon.png">
    <link rel="apple-touch-icon" href="/img/logos/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/logos/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/logos/apple-touch-icon-114x114.png">

    <!-- plugins -->
    <link rel="stylesheet" href="/css/plugins.css">

    <!-- search css -->
    <link rel="stylesheet" href="/search/search.css">

    <!-- quform css -->
    <link rel="stylesheet" href="/quform/css/base.css">

    <!-- theme core css -->
    <link href="/css/styles.css" rel="stylesheet">

</head>

<body>

<!-- PAGE LOADING -->
<div id="preloader"></div>

<!-- MAIN WRAPPER -->
<div class="main-wrapper">

    <!-- HEADER -->
    <th:block th:include="/admin/fragment/headerFragment::adminInfo"/>

    <!-- PAGE TITLE -->
    <section class="page-title-section top-position1 bg-img cover-background"
             data-background="/img/about/img_3.png">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>Transaction History</h1>
                </div>
            </div>

        </div>
    </section>

    <!-- TABLES -->
    <section>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-9">

                    <div class="position-relative elements-block">

                        <div class="inner-title">
                            <div class="main-title title-left mb-0">Filter
                                <span class="line-left"></span>
                            </div>
                        </div>
                        <!-- FILTER FORM -->
                        <form id="filterForm"
                              style="max-width: 600px; margin: 0 auto; padding: 20px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <div style="flex: 1; margin-right: 10px;">
                                    <label for="moneyType">Money Type:</label>
                                    <select class="select" id="moneyType" name="moneyType">
                                        <option value="">-- Money Type --</option>
                                        <option value="USD">USD</option>
                                        <option value="AMD">AMD</option>
                                        <option value="RUB">RUB</option>
                                    </select>
                                </div>
                                <div style="flex: 1; margin-right: 10px;">
                                    <label for="status">Status:</label>
                                    <select class="select" id="status" name="status">
                                        <option value="">-- Status --</option>
                                        <option value="DURING">DURING</option>
                                        <option value="FINISHED">FINISHED</option>
                                    </select>
                                </div>
                                <div style="flex: 1;">
                                    <label for="transactionType">Transaction Type:</label>
                                    <select class="select" id="transactionType" name="transactionType">
                                        <option value="">-- Transaction Type --</option>
                                        <option value="PERSONAL">Personal</option>
                                        <option value="BUSINESS">Business</option>
                                        <option value="EDUCATION">Education</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <div style="flex: 1; margin-right: 10px;">
                                    <label for="minSize">Minimum Size:</label>
                                    <input type="number" id="minSize" name="minSize" step="0.01">
                                </div>
                                <div style="flex: 1; margin-right: 10px;">
                                    <label for="maxSize">Maximum Size:</label>
                                    <input type="number" id="maxSize" name="maxSize" step="0.01">
                                </div>
                            </div>
                        </form>


                        <!-- TRANSACTION TABLE -->
                        <div id="transactionTable" class="table-responsive">
                            <table class="table mb-0">
                                <thead>
                                <tr>
                                    <th>Size</th>
                                    <th>Money Type</th>
                                    <th>Percentage</th>
                                    <th>Issue Date</th>
                                    <th>Finish Date</th>
                                    <th>Remaining Money</th>
                                    <th>Status</th>
                                    <th>Transaction Type</th>
                                    <th>User</th>
                                    <th>Months</th>
                                    <th>Single Page</th>
                                </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>
                            <br>
                            <br>
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                            <span class="sr-only">Previous</span>
                                        </a>
                                    </li>
                                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                            <span class="sr-only">Next</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="footer1 bg-img cover-background" data-overlay-dark="8" data-background="img/bg/footer-bg.jpg">
        <!-- Footer content goes here -->
    </footer>

</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/core.min.js"></script>
<script src="/search/search.js"></script>
<script src="/quform/js/plugins.js"></script>
<script src="/quform/js/scripts.js"></script>
<script src="/js/main.js"></script>

<script>
    $(document).ready(function () {
        var currentPage = 1;

        function updateTransactionTable(page) {
            $.ajax({
                url: '/filterTransactions?page=' + page,
                type: 'GET',
                data: $('#filterForm').serialize(),
                success: function (response) {
                    var tbody = $('#transactionTable tbody');
                    tbody.empty();
                    response.transactions.forEach(function (transaction) {
                        var row = $('<tr>');
                        row.append('<td>' + transaction.size + '</td>');
                        row.append('<td>' + transaction.moneyType + '</td>');
                        row.append('<td>' + transaction.percentage + '</td>');
                        row.append('<td>' + transaction.issueDate + '</td>');
                        row.append('<td>' + transaction.finishDate + '</td>');
                        row.append('<td>' + transaction.remainingMoney + '</td>');
                        row.append('<td>' + transaction.status + '</td>');
                        row.append('<td>' + transaction.transactionType + '</td>');
                        row.append('<td>' + transaction.user.name + '</td>');
                        row.append('<td>' + transaction.months + '</td>');
                        row.append('<td><a href="/creditSinglePage/' + transaction.id + '">Single Page</a></td>');
                        tbody.append(row);
                    });

                    updatePagination(response.currentPage, response.totalPages);
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        }

        function updatePagination(currentPage, totalPages) {
            var pagination = $('.pagination');
            pagination.empty();

            pagination.append('<li class="page-item ' + (currentPage === 1 ? 'disabled' : '') + '">'
                + '<a class="page-link" href="#" aria-label="Previous">'
                + '<span aria-hidden="true">&laquo;</span>'
                + '<span class="sr-only">Previous</span>'
                + '</a>'
                + '</li>');

            for (var i = 1; i <= totalPages; i++) {
                pagination.append('<li class="page-item ' + (i === currentPage ? 'active' : '') + '">'
                    + '<a class="page-link" href="#">' + i + '</a>'
                    + '</li>');
            }

            pagination.append('<li class="page-item ' + (currentPage === totalPages ? 'disabled' : '') + '">'
                + '<a class="page-link" href="#" aria-label="Next">'
                + '<span aria-hidden="true">&raquo;</span>'
                + '<span class="sr-only">Next</span>'
                + '</a>'
                + '</li>');


            pagination.find('a.page-link').on('click', function (e) {
                e.preventDefault();
                var page = $(this).text();
                if (!isNaN(page)) {
                    currentPage = parseInt(page);
                    updateTransactionTable(currentPage);
                } else if ($(this).attr('aria-label') === 'Previous' && currentPage > 1) {
                    currentPage--;
                    updateTransactionTable(currentPage);
                } else if ($(this).attr('aria-label') === 'Next' && currentPage < totalPages) {
                    currentPage++;
                    updateTransactionTable(currentPage);
                }
            });
        }

        $('#filterForm input, #filterForm select').on('input', function () {
            currentPage = 1;
            updateTransactionTable(currentPage);
        });


        updateTransactionTable(currentPage);
    });

</script>
</body>

</html>
